Environmental considerations (penalties for traffic, noise, town, no river, no forest) are possible due to the creation of pseudo tags during processing OSM data by spatial SQL queries [https://github.com/abrensch/brouter/blob/master/misc/scripts/mapcreation/brouter.sql](url). During this processing, roads are extended by a 50 m buffer creating 100 m wide lines. Then it is calculated what percentage of such line is at a specific distance to a noise source or within a forest, for example. The percentage is converted to a factor and the factor is assigned to a class. For traffic, calculations are on another level of complexity. A way can be long and go through different environments, so a class is average for the whole way length. To improve calculations one can divide such ways at junctions by editing in OSM.

### consider_noise, noise_penalty
For proximity of noisy roads (secondary and higher). The noise factor represents the proportion of a road's buffer area that is inside noisy road buffers. This proportion is reduced: 
- for motorways and trunk roads with max speed < 105 by 1.5
- for primary roads 2 times 
- 3 times if maxspeed is 75 - 105  for primary and secondary
- other secondary roads 5 times 

Noise class is roughly proportional to the noise factor:

noise_factor = noise class
- < 0.1             =                            '1'
- < 0.25            =                          '2'
- < 0.4              =                           '3'
- < 0.55               =                        '4'
- < 0.8                   =                      '5'
- ELSE                     =                    '6'

A way parallel to a motorway or trunk road, to have the noise class 6, must be up to 20 m from the middle of the carriageway with a speed limit > 105. For a class 5, the distance must be up to 55 meters.  1 - noise factor for a given class determines the distance.

**Max noise class:**
| Max speed | Motorway|Primary|Secondary   	|
|---				|---			|---		|---	|
| >105   		|6  			|4	  	| 3  	|
| 105				|5		   	|4	   	|3   	|
| 75		  	|5		   	|3 	  	|2   	|


### consider_river, no_river_penalty
river_see overlap = river class 
- < 0.17                  =                  '1'
- < 0.35                     =                '2'
- < 0.57                      =              '3'
- < 0.80                       =             '4'
- < 0.95                        =            '5'
- ELSE                            =           '6'

### consider_forest, no_forest_penalty
OSM data recognized as forest: 
- landuse: forest, allotments, flowerbed, orchard, vineyard, recreation_ground, village_green
- leisure: garden, park, nature_reserve

Imagine you trace the way with a pencil drawing lines 100 meters wide. Then estimated_forest_class=6 corresponds to the case that 98% of the line is in the woodland. This number is called a green factor.

green_factor = forest class
- < 0.1             =                         NULL
- < 0.2               =                             '1'
- < 0.4                 =                           '2'
- < 0.6 		=          '3'
- < 0.8                   =                         '4'
- < 0.98               =                           '5'
- ELSE                    =                        '6'



### consider_town, town_penalty 
Town_class is determined by population data from OSM.

Class
- 1 = 	50-80 	k people
- 2 = 80-150 k people
- 3 =	150 - 400 k people
- 4 = 400 - 1,000 k people
- 5 = 1 - 2 million people
- 6 = > 2 million people

### consider_traffic, traffic_penalty
(modified copy from the sql file).
OSM data used to estimate the traffic:
-    population of towns (+ distance from position to the towns)
-    size of industrial areas (landuse=industrial) and distance to them. From 1.7.3 not considered: solar & wind farms.
-    airports international (from 1.7.3)
-    motorway and trunk road density - traffic on motorways decreases traffic on primary/secondary/tertiary. Calculated on a grid (100 km^2)
-    density of highways (tertiary and higher) calculated on a grid (100 km^2). Traffic decreases when more such roads are available.     Exceptions: near junctions between motorways and other roads the traffic increases on these roads.
-    mountain-ranges calculated as density of peaks > 400 m (line 833 ) traffic is generally on highways in such regions higher as only generated by the local population or industrial areas
- calculate traffic from the population (for each segment of type primary secondary tertiary)
- SUM of (population of each town < 100 km) / ( town-radius + 2500 + dist(segment-position to the town) ** 2 )
-  town-radius is calculated as sqrt(population)
